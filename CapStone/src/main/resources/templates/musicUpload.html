<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org" 
	    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	    layout:decorate="~{layouts/layout}">


<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
  <script th:inline="javascript">
  
		  window.onload = function() {
		      // 이미지가 로드된 후에 실행될 코드
		      displayDefaultImage();
		  };
		  
		  $(document).ready(function(){
		  	console.log("에레 메서지 출력 실행");
		  	var errorMessage = /*[[${errorMessage}]]*/ '';
		    if(errorMessage != null){
		      alert(errorMessage);
		    }
		    
		    musicFileEvent();
		    musicImageEvent();
		  });
		  
		  function musicFileEvent() {
			    console.log("bindDomEvent function is called!");
			    $(".music-file-input").on("change", function () {
			        // 서버에 이미지 파일 여부 확인 요청
			        var formData = new FormData();
			        formData.append('file', this.files[0]);

			        $.ajax({
			            url: '/checkMusic',
			            type: 'POST',
			            data: formData,
			            processData: false,
			            contentType: false,
			            success: function (response) {
			                if (response.isAudio) {
			                    var fileName = response.musicTitle;
			                	$("#originalTitle").val(fileName);
			                } else {
			                    alert("음악 파일만 등록이 가능합니다.");
			                }
			            },
			            error: function () {
			                alert("server error");
			            }
			        });
			    });
			}
		  
		  function musicImageEvent() {
			    console.log("bindDomEvent function is called!");
			    $(".music-Image-input").on("change", function () {
			        // 서버에 이미지 파일 여부 확인 요청
			        var formData = new FormData();
			        formData.append('file', this.files[0]);

			        $.ajax({
			            url: '/checkImage',
			            type: 'POST',
			            data: formData,
			            processData: false,
			            contentType: false,
			            success: function (response) {
			                if (response.isImage) {
			                    // 이미지 파일일 경우 프로필 이미지 변경
			                    displaySelectedImage(response.encodedImage);
			                } else {
			                	displayDefaultImage();
			                    alert("이미지 파일만 등록이 가능합니다.");
			                }
			            },
			            error: function () {
			                alert("서버 오류가 발생했습니다.");
			            }
			        });
			    });
			}

			// 이미지 파일이면 프로필 이미지 변경
			function displaySelectedImage(encodedImage) {
			    const image = document.getElementById("musicImage");
			    const fileInput = document.getElementById("musicImageInput");

			    const selectedFile = fileInput.files[0];

			    if (selectedFile) {
			        // 이미지 파일의 Base64 데이터를 이용하여 이미지 변경
			        image.src = 'data:' + selectedFile.type + ';base64,' + encodedImage;
			    }
			}
			
			// 이미지 파일이 아닐 경우 기본 이미지 유지
			function displayDefaultImage() {
			    const image = document.getElementById("musicImage");
			    const defaultImageSrc = image.getAttribute("data-default-src");
			
			 // 일정 시간이 지난 후에 이미지를 표시
			    setTimeout(function() {
			        image.src = defaultImageSrc;
			    }, 100); // 예: 100 밀리초 후에 실행
			}


  </script>

</th:block>

<div layout:fragment="head">
	<meta charset="UTF-8">
    <meta content="MusicUpload" property="og:title" />
    <meta content="MusicUpload" property="twitter:title" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <link
        th:href="@{/css/musicUpload.css}"
        rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script
        type="text/javascript">WebFont.load({ google: { families: ["Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic", "Roboto:300,regular,500", "Roboto Condensed:300,regular,700", "Roboto Slab:300,regular,700", "Arbutus Slab:regular"] } });</script>
    <script
        type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
    <link
        href="https://assets-global.website-files.com/65085ce06a89f83f850a1961/65085ce06a89f83f850a19dc_New%20icon.ico"
        rel="shortcut icon" type="image/x-icon" />
    <link
        href="https://assets-global.website-files.com/65085ce06a89f83f850a1961/65085ce06a89f83f850a19f2_metric-webclip.png"
        rel="apple-touch-icon" />
</div>

<div layout:fragment="content" id="content-container">
    <div data-delay="4000" data-animation="slide" class="slider w-slider" data-autoplay="false" data-easing="ease"
        data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3"
        data-duration="500" data-infinite="true">
        <div class="w-slider-mask">
            <div class="slide _1 w-slide">
                <div class="w-container"></div>
            </div>
            <div class="slide _2 w-slide">
                <div class="w-container"></div>
            </div>
            <div class="slide _3 w-slide">
                <div class="w-container"></div>
            </div>
        </div>
        <div class="w-slider-arrow-left">
            <div class="w-icon-slider-left"></div>
        </div>
        <div class="w-slider-arrow-right">
            <div class="w-icon-slider-right"></div>
        </div>
        <div class="w-slider-nav w-round"></div>
    </div>
    <div id="features" data-w-id="62e437ac-c9a3-3226-3092-d9ad5af8c296" class="main-section">
        <div class="music-upload-form-block w-form">
            <form id="music-upload-form" name="music-upload-form"  method="post" class="music-upload-form" enctype="multipart/form-data" th:object="${musicDto}">
            <label href="#" class="music-file-upload-button w-button" th:onclick="musicFileInput.click()">File Upload</label>
            <input type="file" name="musicUploadFile" id="musicFileInput" class="music-file-input" style="display: none;">
                <div class="music-upload-div-block">
                    <div class="music-image-upload-div-block">
                    	<img id="musicImage" th:src="@{/static/images/profile_image.svg}" loading="lazy" alt="" class="music-upload-image" th:data-default-src="@{/static/images/profile_image.svg}" />
                       	<label href="#" class="muisc-image-upload-button w-button" th:onclick="musicImageInput.click()">Upload Image</label>
                        <input type="file" name="musicImgFile" id="musicImageInput" class="music-Image-input" style="display: none;" th:onchange="displaySelectedImage()">
                    </div>

                    <div class="music-upload-detail-div-block">
                        <div class="music-upload-detail-text-block-ot">Original Title</div>
                        <input type="text" class="music-upload-detail-text-field-ot w-input" maxlength="256" name="name"
                             placeholder="" id="originalTitle" th:field="*{title}"/>
                             
                        <div class="music-upload-detail-text-block-os">Original Singer</div>
                        <input type="text" class="music-upload-detail-text-field-os w-input" maxlength="256" name="email"
                             placeholder="" id="email" th:field="*{oriSinger}" />
                             
                        <div class="music-upload-detail-text-block-as">AI Singer</div>
                        <input type="text" class="music-upload-detail-text-field-as w-input" maxlength="256" name="email-2"
                             placeholder="" id="email-2" required="" th:field="*{aiSinger}"/>
                             
                        <div class="music-upload-detail-text-field-genre">Genre</div>
                        <select th:field="*{genre}" id="field" name="field" class="music-upload-genre-select-field w-select">
                            <option value="HipHop">HipHop</option>
                            <option value="Ballad">Ballad</option>
                            <option value="R&amp;B">R&amp;B</option>
                            <option value="Pop">Pop</option>
                            <option value="Rock&amp;Metal">Rock&amp;Metal</option>
                            <option value="Jazz">Jazz</option>
                            <option value="J-Pop">J-Pop</option>
                            <option value="Trot">Trot</option>
                            <option value="Latin">Latin</option>
                            <option value="Indie">Indie</option>
                            <option value="Acoustic">Acoustic</option>
                            <option value="Dance&amp;Electronic">Dance&amp;Electronic</option>
                        </select><input type="submit" th:formaction="@{/private/musicUpload}" value="Save"
                            class="music-upload-submit-button w-button" />
                    </div>
                </div>
            </form>
        </div>
    </div>
   
    <script th:src="@{/js/musicUpload.js}"
        type="text/javascript"></script>
   
</div>

</html>